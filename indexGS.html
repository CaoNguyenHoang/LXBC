<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no" />
<title>LXBC - M·ª´ng gi√°ng sinh </title>
<meta name="description" content="Trang web tƒ©nh: theme V√†ng-ƒêen, hi·ªáu ·ª©ng tuy·∫øt r∆°i chi·ªÅu s√¢u 3D (tr∆∞·ªõc/sau n·ªôi dung)." />
<meta name="theme-color" content="#0b0b0b" />

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700;800&display=swap&subset=vietnamese" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer></script>

<style>
/* ===== VARIABLES & RESET ===== */
:root {
  --bg: #0b0b0b;
  --card: #121315;
  --text: #f5f5f5;
  --muted: #9ca3af;
  --border: #27272a;
  --brand: #ffc800; /* V√ÄNG GOLD CH·ª¶ ƒê·∫†O */
  
  /* Hi·ªáu ·ª©ng bƒÉng gi√° */
  --frost-blue: 137, 207, 240;
  --frost-glow: 0 5px 25px rgba(var(--frost-blue), 0.45); 
  --frost-border: 1px solid rgba(var(--frost-blue), 0.35); 

  --safe-top: env(safe-area-inset-top);
  --font-ui: 'Be Vietnam Pro', sans-serif;
  --radius: 12px;
}
*,*::before,*::after { box-sizing: border-box; }
html { scroll-behavior: smooth; }
body { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: var(--font-ui); line-height: 1.5; -webkit-tap-highlight-color: transparent; overflow-x: hidden; position: relative; }
a { color: inherit; text-decoration: none; }
img { max-width: 100%; display: block; }
.container { max-width: 1200px; margin: 0 auto; padding: 0 16px; }

/* ===== TUY·∫æT R∆†I CHI·ªÄU S√ÇU (2 L·ªöP CANVAS) ===== */
/* Style chung cho c·∫£ 2 l·ªõp canvas */
.snow-canvas {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  pointer-events: none; /* Kh√¥ng ch·∫∑n click chu·ªôt */
}

/* L·ªõp H·∫≠u C·∫£nh (R∆°i SAU c√°c th·∫ª, n√∫t) */
#snowBack {
    z-index: -1; /* N·∫±m sau n·ªôi dung ch√≠nh */
    opacity: 0.7; /* M·ªù h∆°n ch√∫t */
    filter: blur(1px); /* H∆°i nh√≤e ƒë·ªÉ t·∫°o c·∫£m gi√°c xa */
}

/* L·ªõp Ti·ªÅn C·∫£nh (R∆°i TR∆Ø·ªöC t·∫•t c·∫£) */
#snowFront {
    z-index: 9999; /* N·∫±m tr√™n c√πng */
    opacity: 0.95; /* R√µ n√©t */
}


/* ===== UI COMPONENTS ===== */
/* Navbar */
.nav { 
  position: sticky; top: 0; z-index: 1000; 
  background: rgba(11, 11, 11, 0.85);
  backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
  border-bottom: var(--frost-border);
  transition: transform 0.3s; will-change: transform;
  box-shadow: 0 4px 15px rgba(var(--frost-blue), 0.15);
}
.nav-inner { display: flex; align-items: center; justify-content: space-between; height: calc(56px + var(--safe-top)); padding-top: var(--safe-top); position: relative; }

/* Brand Logo */
.brand { display: flex; align-items: center; gap: 8px; font-weight: 800; font-size: 1.15rem; letter-spacing: -0.5px; }
.brand-logo { 
  width: 32px; height: 32px; border-radius: 8px; 
  border: 1px solid #333;
  box-shadow: 0 0 15px rgba(var(--frost-blue), 0.4);
}
/* Th√™m d·∫•u > ƒë·ªÉ ch·ªâ √°p d·ª•ng cho th·∫ª span c·∫•p 1, kh√¥ng √°p d·ª•ng cho th·∫ª con b√™n trong */
.brand > span::after { content: ' üéÑ'; font-size: 1.1em; margin-left: 4px; filter: brightness(1.2); opacity: 1; }
.nav-links { display: flex; gap: 8px; }

/* CHIP BUTTONS */
.chip { 
  padding: 6px 16px; border-radius: 99px; font-size: 0.85rem; font-weight: 600; 
  background: rgba(255,255,255,0.05); color: #ccc; 
  cursor: pointer; transition: all 0.3s ease; 
  border: 1px solid var(--border);
}
.chip:hover { 
  background: rgba(11, 11, 11, 0.9); color: var(--brand); border-color: var(--brand);
  box-shadow: var(--frost-glow); 
}

/* Sections */
/* Quan tr·ªçng: background trong su·ªët ƒë·ªÉ th·∫•y tuy·∫øt l·ªõp sau */
.section { padding: 48px 0; border-bottom: 1px solid var(--border); content-visibility: auto; contain-intrinsic-size: 500px; background: transparent; }
.section h2 { font-size: clamp(24px, 4vw, 36px); margin: 0 0 20px; font-weight: 800; letter-spacing: -1px; color: var(--text); }

/* Motto */
.motto-frame {
  display: inline-block; padding: 8px 24px; margin-bottom: 24px; position: relative; overflow: hidden;
  background: linear-gradient(180deg, rgba(30, 30, 30, 0.9), rgba(10, 10, 10, 0.9));
  border: 1px solid rgba(255, 200, 0, 0.6);
  border-radius: 99px;
  box-shadow: inset 0 0 15px rgba(0,0,0,1), 0 5px 20px rgba(var(--frost-blue), 0.25);
  color: var(--brand); font-weight: 800; text-transform: uppercase; letter-spacing: 1.5px; 
  font-size: clamp(0.85rem, 3vw, 1.1rem); text-shadow: 0 2px 10px rgba(255, 200, 0, 0.3);
  z-index: 2; /* ƒê·∫£m b·∫£o n·∫±m tr√™n tuy·∫øt h·∫≠u c·∫£nh */
}
.motto-frame::after {
  content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%; opacity: 0;
  transform: skewX(-20deg); 
  background: linear-gradient(to right, transparent 0%, rgba(255, 255, 255, 0.3) 30%, rgba(255, 200, 0, 0.5) 50%, transparent 100%);
  animation: goldSheen 10s ease-in-out infinite;
}
@keyframes goldSheen { 0% { left: -100%; opacity: 0; } 5% { opacity: 1; } 20% { left: 200%; opacity: 0; } 100% { left: 200%; opacity: 0; } }

.sub-head { font-size: 1.1rem; margin: 32px 0 16px; color: var(--brand); font-weight: 700; border-left: 4px solid var(--brand); padding-left: 12px; }

/* BUTTONS */
.btn-more, .intro-readmore, .btn {
  display: inline-flex; align-items: center; justify-content: center;
  padding: 10px 28px; border-radius: 99px;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  color: var(--brand);
  font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;
  cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-size: 0.85rem; text-decoration: none;
  z-index: 2; /* N·∫±m tr√™n tuy·∫øt h·∫≠u c·∫£nh */
  position: relative;
}
.btn-more:hover, .intro-readmore:hover, .btn:hover {
  background: var(--brand);
  border-color: var(--brand); color: #000;
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(255, 200, 0, 0.4), 0 0 25px rgba(var(--frost-blue), 0.4);
}
.btn-more:active, .intro-readmore:active, .btn:active { transform: scale(0.96); }

.intro-text { margin: 0 auto; color: #d1d5db; max-width: 700px; font-size: 1rem; line-height: 1.7; text-align: justify; text-indent: 2em; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; position: relative; z-index: 2; }
.intro-text.expanded { -webkit-line-clamp: unset; }
.intro-readmore { margin-top: 24px; } 

/* Search & Filters */
.filter-row { display: flex; align-items: center; gap: 10px; margin-bottom: 24px; height: 44px; position: relative; z-index: 5; }
.search-wrap { position: relative; width: 44px; height: 44px; z-index: 90; transition: width 0.3s cubic-bezier(0.16, 1, 0.3, 1); flex-shrink: 0; }
.search-trigger { position: absolute; inset: 0; border-radius: 99px; background: #202023; border: 1px solid var(--border); color: var(--muted); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; }
.search-trigger:hover { color: var(--brand); border-color: var(--brand); box-shadow: var(--frost-glow); }
.search-input { position: absolute; inset: 0; width: 100%; height: 100%; background: transparent; border: none; color: transparent; padding: 0; pointer-events: none; opacity: 0; border-radius: 99px; font-family: inherit; transition: 0.2s; }
.search-wrap.open { width: 100%; max-width: 300px; }
.search-wrap.open .search-trigger { opacity: 0; pointer-events: none; transform: scale(0.8); }
.search-wrap.open .search-input { background: #18181b; border: 1px solid var(--brand); color: #fff; padding: 0 16px; opacity: 1; pointer-events: auto; box-shadow: 0 4px 20px rgba(255, 200, 0, 0.3), var(--frost-glow); }
.quick-filters { display: flex; gap: 8px; overflow-x: auto; flex: 1; scrollbar-width: none; padding-right: 16px; align-items: center; -webkit-overflow-scrolling: touch; }
.quick-filters::-webkit-scrollbar { display: none; }
.q-btn { white-space: nowrap; padding: 0 16px; height: 44px; border-radius: 99px; border: 1px solid var(--border); background: #17191b; color: #9ca3af; font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: 0.2s; }
.q-btn:hover { background: #222; color: #fff; border-color: rgba(var(--frost-blue), 0.6); }
.q-btn.active { background: rgba(255,200,0,0.15); border-color: var(--brand); color: var(--brand); box-shadow: var(--frost-glow); }

/* ===== MEMBERS GRID ===== */
.team-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; position: relative; z-index: 2; }
@media (min-width: 600px) { .team-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; } }

.hidden-item { display: none !important; }

.member-card { 
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; 
  position: relative; cursor: pointer; contain: paint;
  transform: translateZ(0); backface-visibility: hidden; will-change: transform;
  transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
  /* Card l√† kh·ªëi ƒë·∫∑c n√™n s·∫Ω che tuy·∫øt h·∫≠u c·∫£nh */
}
.member-card:hover { 
  transform: translateY(-4px); 
  border-color: rgba(var(--frost-blue), 0.5);
  box-shadow: 0 10px 30px rgba(0,0,0,0.4), var(--frost-glow);
}

@keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
.member-photo { 
  aspect-ratio: 3/4; overflow: hidden; 
  background: #1a1a1a; 
  background: linear-gradient(90deg, #1a1a1a 25%, #222 50%, #1a1a1a 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}
.member-photo img { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.3s; }

.member-info { padding: 8px 4px; text-align: center; position: absolute; bottom: 0; inset-inline: 0; background: linear-gradient(to top, rgba(0,0,0,0.95) 20%, transparent); }
.m-name { font-weight: 700; font-size: 0.8rem; color: #fff; margin-bottom: 2px; text-shadow: 0 2px 4px rgba(0,0,0,0.8); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.m-role { font-size: 0.65rem; color: var(--brand); font-weight: 600; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
@media (min-width: 600px) {
  .member-info { padding: 12px 8px; }
  .m-name { font-size: 0.9rem; }
  .m-role { font-size: 0.75rem; }
}

/* ===== ACTIVITY CARD ===== */
#actGrid { display: grid; gap: 20px; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); position: relative; z-index: 2; }
.act-card { 
  height: 250px; border-radius: 16px; position: relative; overflow: hidden; border: 1px solid var(--border); 
  background: #000; contain: paint;
  transform: translateZ(0); backface-visibility: hidden; will-change: transform;
  transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s; 
  /* Card l√† kh·ªëi ƒë·∫∑c n√™n s·∫Ω che tuy·∫øt h·∫≠u c·∫£nh */
}
.act-card:hover { 
  transform: translateY(-4px); 
  border-color: rgba(var(--frost-blue), 0.5);
  box-shadow: var(--frost-glow);
}
.act-bg { position: absolute; inset: 0; z-index: 0; background: #1a1a1a; }
.act-bg img { width: 100%; height: 100%; object-fit: cover; opacity: 0.7; filter: brightness(0.8); transition: transform 0.6s; }
.act-card:hover .act-bg img { transform: scale(1.05); }
.act-content { 
  position: absolute; inset: 0; z-index: 2; 
  padding: 16px; display: flex; flex-direction: column; justify-content: flex-end; 
  background: linear-gradient(to bottom, transparent 30%, rgba(0,0,0,0.95) 100%); 
}
.ribbon { position: absolute; top: 12px; right: -32px; transform: rotate(45deg); background: var(--brand); color: #000; font-size: 0.65rem; font-weight: 800; padding: 4px 34px; z-index: 10; text-transform: uppercase; box-shadow: 0 2px 5px rgba(0,0,0,0.5); }
.act-title { font-size: 1.15rem; font-weight: 800; margin: 0 0 6px; line-height: 1.3; color: #fff; }
.act-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 8px; }
.act-chip { font-size: 0.7rem; padding: 3px 8px; border-radius: 6px; background: rgba(255,255,255,0.15); backdrop-filter: blur(4px); color: #eee; font-weight: 600; }
.act-sum { 
  font-size: 0.85rem; color: #d1d5db; line-height: 1.4; margin-bottom: 12px; 
  display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; 
}
/* N√∫t ho·∫°t ƒë·ªông */
.act-btn { 
  align-self: flex-start; background: var(--brand); color: #000; 
  padding: 8px 20px; border-radius: 99px; font-size: 0.8rem; font-weight: 700; text-transform: uppercase;
  transition: 0.2s; border: none;
}
.act-btn:hover { 
  background: #fff; color: #000; transform: translateY(-2px); 
  box-shadow: 0 4px 12px rgba(255, 200, 0, 0.5), var(--frost-glow); 
}

/* Modals */
.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 10000; /* Z-index cao h∆°n tuy·∫øt ti·ªÅn c·∫£nh */ display: none; align-items: center; justify-content: center; padding: 16px; opacity: 0; transition: opacity 0.2s; pointer-events: none; }
.modal.open { display: flex; opacity: 1; pointer-events: auto; }
.modal-box { background: #111; border: 1px solid #333; width: 100%; max-width: 420px; border-radius: 20px; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.8); display: flex; flex-direction: column; max-height: 90vh; transform: scale(0.95); transition: transform 0.2s cubic-bezier(0.16, 1, 0.3, 1); }
.modal.open .modal-box { transform: scale(1); box-shadow: 0 25px 50px -12px rgba(0,0,0,0.8), var(--frost-glow); }
.modal-header { padding: 14px 20px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; background: #161616; }
.modal-title { font-weight: 700; font-size: 1.05rem; }
.close-btn { background: none; border: none; color: #888; font-size: 1.5rem; cursor: pointer; padding: 0 4px; transition: color 0.2s; }
.close-btn:hover { color: #fff; }
.modal-content { padding: 24px; overflow-y: auto; }
.m-detail-grid { display: flex; flex-direction: column; align-items: center; gap: 20px; }
.m-big-avt { width: 140px; height: 140px; border-radius: 50%; object-fit: cover; border: 4px solid #222; box-shadow: 0 8px 30px rgba(0,0,0,0.5), var(--frost-glow); }
.m-info-list { width: 100%; text-align: center; }
.info-row { margin-bottom: 8px; font-size: 0.95rem; }
.info-lbl { color: #888; font-size: 0.85rem; font-weight: 500; margin-right: 6px; }
.info-lbl::after { content: ":"; }
.info-val { color: #fff; font-weight: 600; }
.contact-actions { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 24px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); }
.c-btn { display: flex; align-items: center; justify-content: center; gap: 8px; padding: 12px; border-radius: 12px; font-weight: 600; font-size: 0.9rem; background: #222; color: #fff; transition: 0.2s; border: 1px solid rgba(255,255,255,0.05); }
.c-btn:hover { transform: translateY(-2px); filter: brightness(1.1); box-shadow: var(--frost-glow); }
.c-btn.facebook { background: #1877F2; }
.c-btn.zalo { background: #0068FF; }
.c-btn.phone { background: #34A853; }
.c-btn.email { background: #EA4335; }
.c-btn.instagram { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); border: none; }
.c-btn.locket { background: #FFAD1F; color: #000; }

/* Slider */
.hero-slider { position: relative; aspect-ratio: 16/9; max-height: 450px; overflow: hidden; background: #000; z-index: 1; }
@media(min-width: 768px) { .hero-slider { aspect-ratio: 21/9; } }
.slide { position: absolute; inset: 0; opacity: 0; transition: opacity 1.2s, transform 1.5s; transform: scale(1.08); will-change: opacity, transform; }
.slide.active { opacity: 1; transform: scale(1); }
.slide img { width: 100%; height: 100%; object-fit: cover; }
.dots { position: absolute; bottom: 16px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; z-index: 10; }
.dot { width: 8px; height: 8px; border-radius: 50%; background: rgba(255,255,255,0.4); cursor: pointer; transition: 0.3s; }
.dot.active { background: var(--brand); transform: scale(1.4); box-shadow: 0 0 10px rgba(var(--frost-blue), 0.7); }

/* Misc */
.more-container { display: flex; justify-content: center; margin-top: 24px; position: relative; z-index: 2; }
.dropzone { display: flex; gap: 10px; margin-bottom: 20px; padding: 20px; border: 1px dashed #444; border-radius: 16px; justify-content: center; background: #111; position: relative; z-index: 2; }
footer { border-top: 1px solid var(--border); background: #050505; position: relative; z-index: 2; }
.contact-info p { margin-bottom: 12px; font-size: 0.95rem; color: #ccc; }
.contact-info strong { color: var(--brand); }
</style>
</head>
<body>

<canvas id="snowBack" class="snow-canvas"></canvas> <canvas id="snowFront" class="snow-canvas"></canvas> <nav class="nav">
  <div class="container nav-inner">
    <a href="#" class="brand">
      <img src="image/logo.jpg" class="brand-logo" alt="Logo" onerror="this.src='https://via.placeholder.com/40/333/fff?text=L'">
      <span>L∆∞u X√° <span style="color:var(--brand)">Bosco</span></span>
    </a>
    <div class="nav-links">
      <a href="https://www.facebook.com/SinhVienDonboscoSOB" target="_blank" class="chip">SOB</a>
      <button id="btnOpenContact" class="chip">Li√™n h·ªá</button>
    </div>
  </div>
</nav>

<section id="banner" style="border:none;padding:0">
  <div class="hero-slider">
    <div class="slide active"><img src="image/banner1.jpg" alt="Banner 1" fetchpriority="high" loading="eager"></div>
    <div class="slide"><img src="image/banner2.jpg" alt="Banner 2" loading="lazy"></div>
    <div class="slide"><img src="image/banner3.jpg" alt="Banner 3" loading="lazy"></div>
    <div class="dots" id="dots"></div>
  </div>
</section>

<section id="gioi-thieu" class="section">
  <div class="container" style="text-align:center">
    <div class="motto-frame">Ch√¢n T√¨nh ‚Ä¢ H·∫øt M√¨nh</div>
    <div class="intro-text" id="introContent">
      L∆∞u x√° Bosco l√† ng√¥i nh√† chung c·ªßa anh em sinh vi√™n, n∆°i c√πng nhau s·ªëng, h·ªçc t·∫≠p v√† tr∆∞·ªüng th√†nh. Tinh th·∫ßn Don Bosco lu√¥n hi·ªán di·ªán trong t·ª´ng ho·∫°t ƒë·ªông, t·ª´ nh·ªØng b·ªØa c∆°m th√¢n m·∫≠t, nh·ªØng gi·ªù kinh nguy·ªán chung cho ƒë·∫øn nh·ªØng bu·ªïi sinh ho·∫°t th·ªÉ thao s√¥i n·ªïi. T·∫°i ƒë√¢y, m·ªói th√†nh vi√™n ƒë∆∞·ª£c khuy·∫øn kh√≠ch ph√°t tri·ªÉn to√†n di·ªán b·∫£n th√¢n, kh√¥ng ch·ªâ v·ªÅ tri th·ª©c m√† c√≤n v·ªÅ nh√¢n c√°ch v√† ƒë·ªùi s·ªëng ƒë·ª©c tin. Ch√∫ng t√¥i c√πng nhau x√¢y d·ª±ng m·ªôt c·ªông ƒë·ªìng y√™u th∆∞∆°ng, s·∫ª chia v√† gi√∫p ƒë·ª° l·∫´n nhau v∆∞·ª£t qua nh·ªØng kh√≥ khƒÉn c·ªßa ƒë·ªùi s·ªëng sinh vi√™n xa nh√†, h∆∞·ªõng t·ªõi m·ªôt t∆∞∆°ng lai t∆∞∆°i s√°ng v√† t·ªët ƒë·∫πp h∆°n.
    </div>
    <button id="btnIntroMore" class="intro-readmore">Xem th√™m</button>
  </div>
</section>

<section id="thanh-vien" class="section">
  <div class="container">
    <h2>Th√†nh vi√™n</h2>
    <div class="dropzone" id="drop" style="display:none">
      <input id="excelFile" type="file" accept=".xlsx,.xls,.csv" class="btn" style="padding:6px" />
      <button class="btn" id="btnLoad">T·∫£i D·ªØ Li·ªáu</button>
    </div>
    <div class="filter-row">
      <div class="search-wrap" id="searchWrap">
        <div class="search-trigger" id="searchTrigger"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div>
        <input type="text" id="searchInput" class="search-input" placeholder="Nh·∫≠p t√™n th√†nh vi√™n..." autocomplete="off">
      </div>
      <div class="quick-filters">
        <button class="q-btn" onclick="setMode('bdh')" id="btnQ_BDH">ƒêi·ªÅu H√†nh Nh√†</button>
        <button class="q-btn" onclick="setMode('cuu')" id="btnQ_Cuu">C·ª±u Th√†nh Vi√™n</button>
        <button class="q-btn" onclick="setMode('pet')" id="btnQ_Pet">Pet</button>
        <button class="q-btn" onclick="setMode('tt')" id="btnQ_TT">Th∆∞·ªùng tr·ª±c</button>
        <button class="q-btn" id="btnOrg">S∆° ƒê·ªì</button>
      </div>
    </div>
    
    <div id="all-members-grid" class="team-grid"></div>
    
    <div class="more-container"><button class="btn-more" id="btnMore" style="display:none">Xem th√™m</button></div>
  </div>
</section>

<section id="hoat-dong" class="section">
  <div class="container">
    <h2>Ho·∫°t ƒë·ªông</h2>
    <div class="filter-row">
      <div class="search-wrap" id="actSearchWrap">
        <div class="search-trigger" id="actSearchTrigger"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div>
        <input type="text" id="actSearchInput" class="search-input" placeholder="T√¨m ho·∫°t ƒë·ªông..." autocomplete="off">
      </div>
      <div class="quick-filters" id="actFilters"></div>
    </div>
    <div id="actGrid"></div>
    <div class="more-container"><button class="btn-more" id="btnActMore">Xem th√™m</button></div>
  </div>
</section>

<div id="modal" class="modal">
  <div class="modal-box">
    <div class="modal-header"><div class="modal-title">H·ªì s∆° th√†nh vi√™n</div><button class="close-btn" onclick="closeModal('modal')">√ó</button></div>
    <div class="modal-content">
      <div class="m-detail-grid">
        <img id="m-avatar" class="m-big-avt" src="image/logo.jpg">
        <div class="m-info-list">
          <div class="info-row"><span class="info-lbl">T√™n th√°nh</span> <span class="info-val" id="m-holy"></span></div>
          <div class="info-row"><span class="info-lbl">H·ªç t√™n</span> <span class="info-val" id="m-name"></span></div>
          <div class="info-row"><span class="info-lbl">Ch·ª©c v·ª•</span> <span class="info-val" id="m-role"></span></div>
          <div class="info-row"><span class="info-lbl">NƒÉm sinh</span> <span class="info-val" id="m-birth"></span></div>
          <div class="info-row"><span class="info-lbl">Ng√†nh h·ªçc</span> <span class="info-val" id="m-major"></span></div>
          <div class="info-row"><span class="info-lbl">Tr∆∞·ªùng h·ªçc</span> <span class="info-val" id="m-school"></span></div>
          <div class="info-row"><span class="info-lbl">Gia nh·∫≠p</span> <span class="info-val" id="m-join"></span></div>
          <div id="m-bio" style="margin-top:16px;color:#999;font-size:0.9rem;line-height:1.6;font-style:italic"></div>
          <div id="m-contact-btns" class="contact-actions"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="orgModal" class="modal">
  <div class="modal-box" style="max-width:800px">
    <div class="modal-header"><div class="modal-title">S∆° ƒë·ªì c√°c th·∫ø h·ªá</div><button class="close-btn" onclick="closeModal('orgModal')">√ó</button></div>
    <div class="modal-content" id="orgBody"></div>
  </div>
</div>

<div id="contactModal" class="modal">
  <div class="modal-box">
    <div class="modal-header"><div class="modal-title">Th√¥ng tin li√™n h·ªá</div><button class="close-btn" onclick="closeModal('contactModal')">√ó</button></div>
    <div class="modal-content contact-info">
      <p><strong>Cha ƒê·∫∑c Tr√°ch:</strong> Phaolo Nguy·ªÖn To√†n Khoa</p>
      <p><strong>ƒêi·ªán tho·∫°i:</strong> <a href="tel:0909831284" >0909 831 284</a></p>
      <hr style="border-color:#333;margin:16px 0">
      <p><strong>Tr∆∞·ªüng nh√†:</strong> <span id="c-leader-name">ƒêang c·∫≠p nh·∫≠t...</span></p>
      <p><strong>ƒêi·ªán tho·∫°i:</strong> <a id="c-leader-phone" href="#">‚Äî</a></p>
      <hr style="border-color:#333;margin:16px 0">
      <p><strong>ƒê·ªãa ch·ªâ:</strong> S·ªë 161, B√πi Th·ªã Xu√¢n, Ph∆∞·ªùng 2, TP. ƒê√† L·∫°t.</p>
    </div>
  </div>
</div>

<footer>
  <div class="container" style="padding:40px 0;text-align:center;color:#555;font-size:0.85rem">
    ¬© <span id="year"></span> WEB LXBC-DEVELOPPED BY HOWL.
  </div>
</footer>

<script>
/* ================= SYSTEM CORE ================= */
const $ = document.querySelector.bind(document);
const $$ = document.querySelectorAll.bind(document);
const rmAccent = (s) => String(s||'').normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().trim();

const FOLDER_MEM = 'anh_thanh_vien';
const FOLDER_ACT = 'anh_hoat_dong';
const DEFAULT_AVATAR = 'image/logo.jpg';

function debounce(func, timeout = 200){
  let timer;
  return (...args) => {
    clearTimeout(timer);
    timer = setTimeout(() => { func.apply(this, args); }, timeout);
  };
}

const normalizeImg = (u, folder) => {
  u = String(u || '').trim();
  if (!u) return '';
  if (u.match(/^(http|https|data):/i)) {
    if(u.includes('drive.google.com')) {
      const m = u.match(/\/d\/([^/]+)/);
      return m ? `https://drive.google.com/uc?export=view&id=${m[1]}` : u;
    }
    return u;
  }
  u = u.replace(/\\/g, '/');
  const prefix = folder + '/';
  if (u.toLowerCase().startsWith(prefix.toLowerCase())) u = u.substring(prefix.length);
  return folder ? `${folder}/${u}` : u;
};

/* ================= SNOW EFFECT LOGIC (DUAL LAYERS FOR DEPTH) ================= */
(function() {
  // L·∫•y context c·ªßa c·∫£ 2 canvas
  const canvasBack = document.getElementById('snowBack');
  const ctxBack = canvasBack.getContext('2d');
  const canvasFront = document.getElementById('snowFront');
  const ctxFront = canvasFront.getContext('2d');

  let width, height;
  const flakesBack = []; // M·∫£ng tuy·∫øt l·ªõp sau
  const flakesFront = []; // M·∫£ng tuy·∫øt l·ªõp tr∆∞·ªõc

  function resize() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvasBack.width = width;
    canvasBack.height = height;
    canvasFront.width = width;
    canvasFront.height = height;
  }
  window.addEventListener('resize', resize);
  resize();

  function createFlakes() {
    // Gi·ªõi h·∫°n s·ªë l∆∞·ª£ng tuy·∫øt ƒë·ªÉ kh√¥ng b·ªã r·ªëi v√† lag (t·ªïng kho·∫£ng 60 b√¥ng)
    const maxFlakesTotal = width < 600 ? 30 : 60; 

    if (flakesBack.length + flakesFront.length < maxFlakesTotal) {
      // Ng·∫´u nhi√™n ch·ªçn lo·∫°i tuy·∫øt v√† l·ªõp (tr∆∞·ªõc/sau)
      const type = Math.random() > 0.5 ? '‚ùÜ' : '‚Ä¢';
      const isFront = Math.random() > 0.7; // 30% c∆° h·ªôi ra l·ªõp tr∆∞·ªõc
      
      const flake = {
        x: Math.random() * width,
        y: -20, // B·∫Øt ƒë·∫ßu t·ª´ tr√™n ƒë·ªânh m√†n h√¨nh
        t: type, // Lo·∫°i icon
        // C·∫•u h√¨nh d·ª±a tr√™n l·ªõp
        r: isFront ? (Math.random() * 10 + 15) : (Math.random() * 8 + 8), // L·ªõp tr∆∞·ªõc to h∆°n (15-25px), sau nh·ªè h∆°n (8-16px)
        d: isFront ? (Math.random() * 0.5 + 0.8) : (Math.random() * 0.3 + 0.3), // L·ªõp tr∆∞·ªõc r∆°i nhanh h∆°n
        o: isFront ? (Math.random() * 0.3 + 0.7) : (Math.random() * 0.3 + 0.4)  // L·ªõp tr∆∞·ªõc ƒë·∫≠m h∆°n
      };

      if (isFront) flakesFront.push(flake); else flakesBack.push(flake);
    }
  }

  // H√†m v·∫Ω chung cho m·ªôt m·∫£ng tuy·∫øt l√™n m·ªôt context
  function drawLayer(ctx, flakes) {
    ctx.clearRect(0, 0, width, height);
    for (let i = 0; i < flakes.length; i++) {
      const f = flakes[i];
      ctx.fillStyle = "rgba(255, 255, 255, " + f.o + ")";
      ctx.font = f.r + "px sans-serif";
      ctx.fillText(f.t, f.x, f.y); 
    }
  }

  // H√†m di chuy·ªÉn chung cho m·ªôt m·∫£ng tuy·∫øt
  function moveLayer(flakes) {
    for (let i = 0; i < flakes.length; i++) {
      const f = flakes[i];
      f.y += f.d;
      f.x += Math.sin(f.y * 0.01) * 0.2; // Bay l·∫Øc nh·∫π

      // Reset khi r∆°i xu·ªëng ƒë√°y ho·∫∑c bay qu√° xa
      if (f.y > height + 20) {
         // T√°i s·ª≠ d·ª•ng b√¥ng tuy·∫øt b·∫±ng c√°ch ƒë∆∞a l√™n tr√™n c√πng
         f.y = -20; 
         f.x = Math.random() * width;
      }
      if (f.x > width + 20) f.x = -20;
      if (f.x < -20) f.x = width + 20;
    }
  }

  // TƒÉng th·ªùi gian interval ƒë·ªÉ tuy·∫øt r∆°i "th∆∞a" h∆°n (150ms t·∫°o 1 l·∫ßn)
  setInterval(createFlakes, 150); 

  function loop() {
    // V·∫Ω v√† di chuy·ªÉn l·ªõp sau
    drawLayer(ctxBack, flakesBack);
    moveLayer(flakesBack);

    // V·∫Ω v√† di chuy·ªÉn l·ªõp tr∆∞·ªõc
    drawLayer(ctxFront, flakesFront);
    moveLayer(flakesFront);

    requestAnimationFrame(loop);
  }
  loop();
})();

/* ================= DATA & STATE ================= */
let MEMBERS = [], ACTS = [];
let showAllMem = false, activeFilterMode = 'default';
let activeActTag = null, showAllActs = false;

/* ================= INTRO ================= */
$('#btnIntroMore').onclick = () => {
  const c = $('#introContent');
  const b = $('#btnIntroMore');
  c.classList.toggle('expanded');
  b.textContent = c.classList.contains('expanded') ? 'Thu g·ªçn' : 'Xem th√™m';
};

/* ================= SEARCH & FILTER UI ================= */
const setupSearch = (wrapId, inpId, trigId, callback) => {
  const wrap = $(wrapId), inp = $(inpId), trig = $(trigId);
  if(!wrap) return;
  trig.onclick = (e) => { e.stopPropagation(); wrap.classList.add('open'); inp.focus(); };
  document.addEventListener('click', (e) => { if(!wrap.contains(e.target) && inp.value.trim()==='') wrap.classList.remove('open'); });
  inp.addEventListener('input', debounce(() => callback(), 300));
};

setupSearch('#searchWrap', '#searchInput', '#searchTrigger', () => applyFilter());
setupSearch('#actSearchWrap', '#actSearchInput', '#actSearchTrigger', () => renderActs());

window.setMode = (mode) => {
  activeFilterMode = (activeFilterMode === mode) ? 'default' : mode;
  showAllMem = false;
  const btns = { 'bdh': '#btnQ_BDH', 'tt': '#btnQ_TT', 'pet': '#btnQ_Pet', 'cuu': '#btnQ_Cuu' };
  for (const [k, v] of Object.entries(btns)) {
    $(v).classList.toggle('active', activeFilterMode === k);
  }
  applyFilter();
}

/* ================= MODALS ================= */
const modal = $('#modal'), contactModal = $('#contactModal'), orgModal = $('#orgModal');
window.closeModal = (id) => $(`#${id}`).classList.remove('open');
$('#btnOpenContact').onclick = () => contactModal.classList.add('open');
$('#btnOrg').onclick = () => { buildTimeline(); orgModal.classList.add('open'); };
[modal, contactModal, orgModal].forEach(m => {
  m.onclick = (e) => { if(e.target === m) m.classList.remove('open'); }
});

/* ================= MEMBER LOGIC ================= */
const roleRank = { 'truong nha':1, 'quan ly':2, 'giam linh':3, 'hoi truc':4, 'it':5 };
const getRank = (r) => roleRank[rmAccent(r)] || 99;
const isCuu = (r) => /\b(cuu|alumni|former)\b/i.test(rmAccent(r));
const isBDH = (r) => /\b(giam linh|truong nha|quan ly|hoi truc|it|i\.t)\b/i.test(rmAccent(r));
const isPet = (r) => /\b(pet|ctv|thu cung)\b/i.test(rmAccent(r));
const isTT = (r) => /\b(thuong truc|hang xom)\b/i.test(rmAccent(r));

// Helper: Ph√¢n lo·∫°i group cho th√†nh vi√™n
function getGroup(role) {
  if (isBDH(role)) return 'bdh';
  if (isTT(role)) return 'tt';
  if (isPet(role)) return 'pet';
  if (isCuu(role)) return 'cuu';
  return 'mem';
}

function parseMembers(data) {
  let raw = [];
  if(Array.isArray(data)){
    raw = data;
  } else {
    const wb = XLSX.read(data, {type:'array'});
    const ws = wb.Sheets[wb.SheetNames[0]];
    const json = XLSX.utils.sheet_to_json(ws, {header:1, defval:''});
    const [h, ...rows] = json;
    const map = {};
    h.forEach((col, i) => {
      const k = rmAccent(col);
      if (k.includes('ten thanh') || k.includes('bon mang')) map.holy = i;
      else if (k.includes('nganh') || k.includes('major')) map.major = i;
      else if (k.includes('ten') && !k.includes('thanh')) map.name = i;
      else if (k.includes('chuc') || k.includes('role')) map.role = i;
      else if (k.includes('anh') || k.includes('avatar')) map.avatar = i;
      else if (k.includes('sinh') || k.includes('birth')) map.birth = i;
      else if (k.includes('nhap') || k.includes('join')) map.join = i;
      else if (k.includes('truong') || k.includes('school')) map.school = i;
      else if (k.includes('phone') || k.includes('sdt')) map.phone = i;
      else if (k.includes('fb') || k.includes('facebook')) map.fb = i;
      else if (k.includes('zalo')) map.zalo = i;
      else if (k.includes('bio') || k.includes('gioi thieu')) map.bio = i;
      else if (k.includes('email')) map.email = i;
      else if (k.includes('insta')) map.insta = i;
      else if (k.includes('locket')) map.locket = i;
    });
    raw = rows.map(r => ({
      name: r[map.name], 
      role: String(r[map.role] || 'Th√†nh vi√™n'),
      avatarRaw: r[map.avatar], // L∆∞u raw ƒë·ªÉ x·ª≠ l√Ω sau
      holy: r[map.holy], birth: r[map.birth], join: r[map.join], school: r[map.school], major: r[map.major],
      phone: r[map.phone], fb: r[map.fb], zalo: r[map.zalo], bio: r[map.bio], email: r[map.email], insta: r[map.insta], locket: r[map.locket]
    })).filter(m => m.name);
  }

  // X·ª≠ l√Ω ·∫£nh v√† s·∫Øp x·∫øp 1 l·∫ßn duy nh·∫•t
  MEMBERS = raw.map(m => {
    // N·∫øu kh√¥ng c√≥ ·∫£nh -> g√°n logo.jpg ngay l·∫≠p t·ª©c
    const url = normalizeImg(m.avatarRaw || m.avatar, FOLDER_MEM);
    return { 
      ...m, 
      avatar: url ? url : DEFAULT_AVATAR,
      group: getGroup(m.role) 
    };
  });
  
  // S·∫Øp x·∫øp: BƒêH l√™n ƒë·∫ßu
  MEMBERS.sort((a,b) => {
    const ga = a.group === 'bdh' ? 0 : 1;
    const gb = b.group === 'bdh' ? 0 : 1;
    if(ga !== gb) return ga - gb;
    if(a.group === 'bdh') return getRank(a.role) - getRank(b.role);
    return 0;
  });

  updateContactInfo();
  renderAllMembersOnce(); // Render h·∫øt ra DOM
  applyFilter(); // ·∫®n hi·ªán theo logic
}

function updateContactInfo() {
  const leader = MEMBERS.find(m => {
    const r = rmAccent(m.role);
    return r.includes('truong nha') || r.includes('leader');
  });
  const nameEl = document.getElementById('c-leader-name');
  const phoneEl = document.getElementById('c-leader-phone');
  if(leader) {
    if(nameEl) nameEl.textContent = leader.name;
    if(phoneEl) {
      const p = leader.phone || '';
      phoneEl.textContent = p ? p : 'Ch∆∞a c·∫≠p nh·∫≠t SƒêT';
      phoneEl.href = p ? `tel:${p.replace(/\s/g,'')}` : '#';
    }
  } else {
    if(nameEl) nameEl.textContent = "Ch∆∞a c√≥ th√¥ng tin";
  }
}

// === LOGIC M·ªöI: RENDER 1 L·∫¶N DUY NH·∫§T ===
function renderAllMembersOnce() {
  const container = $('#all-members-grid');
  // Render t·∫•t c·∫£ th√†nh vi√™n v√†o DOM. D√πng loading="lazy" v√† decoding="async"
  // Th√™m onerror ƒë·ªÉ backup n·∫øu link ·∫£nh ch·∫øt
  container.innerHTML = MEMBERS.map((m, index) => `
    <div class="member-card" data-idx="${index}" data-name="${rmAccent(m.name)}" data-role="${rmAccent(m.role)}" data-group="${m.group}" onclick="openMemberModal(${index})">
      <div class="member-photo">
        <img src="${m.avatar}" loading="lazy" decoding="async" alt="${m.name}" 
             onerror="this.onerror=null;this.src='${DEFAULT_AVATAR}'">
      </div>
      <div class="member-info"><div class="m-name">${m.name}</div><div class="m-role">${m.role}</div></div>
    </div>
  `).join('');
}

function getLimit() {
  const w = window.innerWidth;
  if (w < 600) return 6; 
  const cols = Math.floor((Math.min(w, 1200) - 32) / 180); 
  let limit = cols * 2;
  return limit < 8 ? 8 : limit;
}

// === LOGIC M·ªöI: CH·ªà ·∫®N/HI·ªÜN TH·∫∫ DIV C√ì S·∫¥N ===
function applyFilter() {
  const term = rmAccent($('#searchInput').value);
  const container = $('#all-members-grid');
  const items = container.children;
  const limit = getLimit();
  
  let visibleCount = 0;
  let matchCount = 0;

  for (let i = 0; i < items.length; i++) {
    const el = items[i];
    const mName = el.getAttribute('data-name');
    const mRole = el.getAttribute('data-role');
    const mGroup = el.getAttribute('data-group');
    
    // 1. Ki·ªÉm tra Search
    const matchSearch = !term || (mName + mRole).includes(term);
    
    // 2. Ki·ªÉm tra Mode Filter
    let matchMode = false;
    if (activeFilterMode === 'default') {
      // M·∫∑c ƒë·ªãnh: Hi·ªán BƒêH + Mem (·∫©n C·ª±u, Pet, Th∆∞·ªùng tr·ª±c tr·ª´ khi search)
      if (term) matchMode = true; // Khi search th√¨ t√¨m trong t·∫•t c·∫£
      else matchMode = (mGroup === 'bdh' || mGroup === 'mem');
    } else {
      // Mode c·ª• th·ªÉ
      matchMode = (mGroup === activeFilterMode);
    }

    if (matchSearch && matchMode) {
      matchCount++;
      // 3. Ki·ªÉm tra Gi·ªõi h·∫°n hi·ªÉn th·ªã (Limit)
      // N·∫øu l√† BƒêH th√¨ lu√¥n hi·ªán, n·∫øu l√† Mem th√¨ t√≠nh limit (·ªü ch·∫ø ƒë·ªô default)
      let shouldShow = true;
      
      if (activeFilterMode === 'default' && !term && !showAllMem) {
        // Trong ch·∫ø ƒë·ªô m·∫∑c ƒë·ªãnh, n·∫øu v∆∞·ª£t qu√° limit th√¨ ·∫©n
        if (visibleCount >= limit) shouldShow = false;
      }
      
      if (shouldShow) {
        el.classList.remove('hidden-item');
        visibleCount++;
      } else {
        el.classList.add('hidden-item');
      }
    } else {
      el.classList.add('hidden-item');
    }
  }

  // C·∫≠p nh·∫≠t n√∫t Xem th√™m
  const btnMore = $('#btnMore');
  // N·∫øu ·ªü ch·∫ø ƒë·ªô default v√† t·ªïng s·ªë kh·ªõp > s·ªë ƒë√£ hi·ªán -> Hi·ªán n√∫t
  if (activeFilterMode === 'default' && !term && matchCount > limit) {
    btnMore.style.display = 'inline-flex';
    btnMore.textContent = showAllMem ? 'Thu g·ªçn' : `Xem th√™m (${matchCount - limit})`;
  } else {
    btnMore.style.display = 'none';
  }
}

$('#btnMore').onclick = () => { showAllMem = !showAllMem; applyFilter(); };
window.addEventListener('resize', debounce(() => { if(activeFilterMode === 'default') applyFilter(); }, 200));

window.openMemberModal = (index) => {
  const m = MEMBERS[index];
  if(!m) return;
  $('#m-avatar').src = m.avatar || DEFAULT_AVATAR;
  $('#m-name').innerText = m.name;
  $('#m-role').innerText = m.role;
  $('#m-holy').innerText = m.holy || '‚Äî';
  $('#m-birth').innerText = m.birth || '‚Äî';
  $('#m-school').innerText = m.school || '‚Äî';
  $('#m-major').innerText = m.major || '‚Äî';
  $('#m-join').innerText = m.join || '‚Äî';
  $('#m-bio').innerText = m.bio || '';
  const links = [
    {k:'fb', c:'facebook', t:'Facebook', l: m.fb},
    {k:'zalo', c:'zalo', t:'Zalo', l: m.zalo},
    {k:'insta', c:'instagram', t:'Instagram', l: m.insta},
    {k:'locket', c:'locket', t:'Locket', l: m.locket},
    {k:'phone', c:'phone', t:'G·ªçi ƒëi·ªán', l: m.phone ? `tel:${m.phone}` : null},
    {k:'email', c:'email', t:'Email', l: m.email ? `mailto:${m.email}` : null}
  ];
  $('#m-contact-btns').innerHTML = links.filter(x => x.l).map(x => `<a href="${x.l}" target="_blank" class="c-btn ${x.c}">${x.t}</a>`).join('');
  modal.classList.add('open');
}

/* ================= ACTIVITY LOGIC ================= */
function parseActs(data) {
  if(Array.isArray(data)) {
    ACTS = data.map(a => ({...a, img: normalizeImg(a.img, FOLDER_ACT)}));
  } else {
    const wb = XLSX.read(data, {type:'array'});
    const ws = wb.Sheets[wb.SheetNames[0]];
    const json = XLSX.utils.sheet_to_json(ws, {header:1, defval:''});
    const [h, ...rows] = json;
    const map = {};
    h.forEach((col, i) => {
      const k = rmAccent(col);
      if(k.includes('tieu de')||k.includes('ten')) map.title=i;
      else if(k.includes('tom tat')||k.includes('mo ta')) map.sum=i;
      else if(k.includes('anh')||k.includes('img')) map.img=i;
      else if(k.includes('link')||k.includes('url')) map.link=i;
      else if(k.includes('hot')||k.includes('noi bat')) map.hot=i;
      else if(k.includes('nam')) map.year=i;
      else if(k.includes('tag')||k.includes('chu de')) map.tag=i;
      else if(k.includes('cta')||k.includes('nut')) map.cta=i;
      else if(k.includes('phu trach')) map.owner=i;
    });

    ACTS = rows.map(r => {
      let hotVal = 999;
      const rawHot = String(r[map.hot] || '').toLowerCase().trim();
      const num = parseInt(rawHot);
      if (!isNaN(num) && num > 0) hotVal = num; else if (rawHot.includes('x')) hotVal = 1;
      return {
        title: r[map.title], sum: r[map.sum], img: normalizeImg(r[map.img], FOLDER_ACT),
        tag: r[map.tag], year: r[map.year], owner: r[map.owner], link: r[map.link] || '#',
        hotVal: hotVal, cta: r[map.cta] || 'Xem chi ti·∫øt'
      };
    }).filter(x => x.title);
    ACTS.sort((a,b) => a.hotVal - b.hotVal);
  }
  const tags = [...new Set(ACTS.map(a => a.tag).filter(Boolean))].sort();
  $('#actFilters').innerHTML = tags.map(t => `<button class="q-btn" onclick="filterAct('${t}')">${t}</button>`).join('');
  renderActs();
}

window.filterAct = (tag) => {
  activeActTag = (activeActTag === tag) ? null : tag;
  $$('#actFilters .q-btn').forEach(btn => btn.classList.toggle('active', btn.innerText === activeActTag));
  showAllActs = false;
  renderActs();
}

function renderActs() {
  const term = rmAccent($('#actSearchInput').value);
  let list = ACTS;
  if (term) list = list.filter(a => rmAccent(a.title + a.tag + a.year).includes(term));
  if (activeActTag) list = list.filter(a => a.tag === activeActTag);
  const displayList = showAllActs ? list : list.slice(0, 3);
  
  $('#actGrid').innerHTML = displayList.map(a => `
    <div class="act-card">
      <div class="act-bg"><img src="${a.img}" loading="lazy" decoding="async" onerror="this.src='image/logo.jpg'"></div>
      ${a.hotVal < 999 ? '<div class="ribbon">N·ªïi b·∫≠t</div>' : ''}
      <div class="act-content">
        <h3 class="act-title">${a.title}</h3>
        <div class="act-tags">
          ${a.tag ? `<span class="act-chip">${a.tag}</span>` : ''}
          ${a.year ? `<span class="act-chip">${a.year}</span>` : ''}
          ${a.owner ? `<span class="act-chip">${a.owner}</span>` : ''}
        </div>
        <p class="act-sum">${a.sum}</p>
        <a href="${a.link}" target="_blank" class="act-btn">${a.cta}</a>
      </div>
    </div>
  `).join('');
  const btnMore = $('#btnActMore');
  if (list.length > 3) { btnMore.style.display = 'inline-flex'; btnMore.textContent = showAllActs ? 'Thu g·ªçn' : 'Xem th√™m'; } 
  else { btnMore.style.display = 'none'; }
}

$('#btnActMore').onclick = () => { showAllActs = !showAllActs; renderActs(); };
$('#btnLoad').onclick = async () => { const f = $('#excelFile').files[0]; if(f){ const b=await f.arrayBuffer(); parseMembers(b); } };

/* ================= ORG CHART ================= */
function buildTimeline(){
  const byYear = new Map();
  const sorted = [...MEMBERS].sort((a,b)=> parseInt(a.join||0) - parseInt(b.join||0));
  sorted.forEach((m, idx) => {
    const r = rmAccent(m.role);
    const allow = r.includes('cuu') || r.includes('thanh vien') || r.includes('truong nha') || r.includes('quan ly') || r.includes('giam linh') || r.includes('hoi truc');
    if(allow) {
      const y = m.join || '‚Äî';
      if(!byYear.has(y)) byYear.set(y, []);
      const originalIdx = MEMBERS.indexOf(m); 
      byYear.get(y).push({ ...m, oIdx: originalIdx });
    }
  });
  let html = '';
  byYear.forEach((arr, y)=>{
    html += `<div style="margin-bottom:24px"><div style="color:var(--brand);font-weight:800;margin-bottom:8px;font-size:1.1rem">NƒÉm ${y}</div><div style="display:flex;flex-wrap:wrap;gap:8px">`;
    arr.forEach(m => { html += `<div class="chip" onclick="closeModal('orgModal');openMemberModal(${m.oIdx})">${m.name} - ${m.role}</div>`; });
    html += `</div></div>`;
  });
  $('#orgBody').innerHTML = html;
}

/* ================= PRELOAD ================= */
const PRE_DATA = [
  { name: "V≈© T·∫•n L·ª±c", role: "Tr∆∞·ªüng nh√†", holy: "Phanxico Xavie", birth: "2005", school: "ƒê·∫°i h·ªçc Yersin", major: "Quan h·ªá c√¥ng ch√∫ng", join: "2023", avatar: "luc.jpg", fb: "https://web.facebook.com/lucc.vux.7", email: "luc3007vu@gmail.com", phone: "0346146212" },
  { name: "B√πi Qu·ªëc Th√°i", role: "Qu·∫£n l√Ω", holy: "Phero-Phaolo", birth: "2006", school: "ƒê·∫°i h·ªçc Yersin", major: "C√¥ng ngh·ªá sinh h·ªçc", join: "2024", avatar: "thai.jpg", fb: "https://www.facebook.com/quoc.thai.62138" },
  { name: "V≈© Nguy·ªÖn B√¨nh An", role: "Gi√°m Linh", holy: "Phero", birth: "2006", school: "ƒê·∫°i h·ªçc ƒê√† L·∫°t", major: "C√¥ng ngh·ªá th√¥ng tin", join: "2024", avatar: "an.jpg", fb: "https://www.facebook.com/annguyen201x" },
  { name: "Bon Krong Y Doan", role: "H·ªôi tr·ª±c", holy: "Giuse", birth: "2005", school: "Cao ƒê·∫≥ng ƒê√† L·∫°t", major: "C√¥ng ngh·ªá th√¥ng tin", join: "2023", avatar: "doan.jpg", fb: "https://www.facebook.com/emdoantoichoi" },
  { name: "Cao Nguy√™n Ho√†ng", role: "Th√†nh Vi√™n", holy: "Giuse", birth: "2006", school: "ƒê·∫°i H·ªçc ƒê√† L·∫°t", major: "C√¥ng ngh·ªá th√¥ng tin", join: "2024", avatar: "hoang.jpg", fb: "https://www.facebook.com/caonguyenhoang1026", email: "2411841@dlu.edu.vn" },
  { name: "Tr·∫ßn Anh D≈©ng", role: "Th√†nh vi√™n", holy: "Giuse", birth: "2006", school: "Cao ƒê·∫≥ng ƒê√† L·∫°t", major: "CN k·ªπ thu·∫≠t √¥ t√¥", join: "2024", avatar: "dung.jpg", fb: "https://www.facebook.com/tran.dung.489667" },
  { name: "Nguy·ªÖn Duy Khang", role: "Th√†nh vi√™n", holy: "ƒêaminh", birth: "2006", school: "Cao ƒê·∫≥ng ƒê√† L·∫°t", major: "CN k·ªπ thu·∫≠t √¥ t√¥", join: "2024", avatar: "khang.jpg", fb: "https://www.facebook.com/nguyen.duy.khang.867135" },
  { name: "Tp√∫h Cao Tr∆∞·ªüng", role: "Th√†nh vi√™n", holy: "Luca", birth: "2003", school: "ƒê·∫°i h·ªçc ƒê√† L·∫°t", major: "Du L·ªãch", join: "2021", avatar: "truong.jpg", fb: "https://www.facebook.com/truong.tpuh" },
  { name: "Nguy·ªÖn Quang Tuy·∫øn", role: "Th√†nh Vi√™n", holy: "ƒêaminh", birth: "2007", school: "Cao ƒê·∫≥ng Y T·∫ø", major: "X√©t nghi·ªám Y h·ªçc", join: "2025", avatar: "tuyen.jpg", fb: "https://www.facebook.com/nguyen.q.tuyen.2025" },
  { name: "Nguy·ªÖn H·ªØu Anh", role: "Th√†nh vi√™n", holy: "Giuse", birth: "2006", school: "ƒê·∫°i h·ªçc Yersin", major: "Thi·∫øt k·∫ø n·ªôi th·∫•t", join: "2024", avatar: "huu.jpg", fb: "https://www.facebook.com/nguyen.huu.anh.183794" },
  { name: "Ph·∫°m ƒê·ªó B·∫£o Tr√≠", role: "Th√†nh vi√™n", holy: "Vincente", birth: "2003", school: "ƒê·∫°i h·ªçc Yersin", major: "CN k·ªπ thu·∫≠t √¥ t√¥", join: "2021", avatar: "tri.jpg", fb: "https://www.facebook.com/pham.tri.881198" },
  { name: "Nguy·ªÖn Duy Kh√¥i", role: "Th√†nh vi√™n", holy: "ƒêaminh", birth: "2007", school: "ƒê·∫°i H·ªçc ƒê√† L·∫°t", major: "C√¥ng ngh·ªá sinh h·ªçc", join: "2025", avatar: "khoi.jpg", fb: "https://www.facebook.com/nguyen.duy.khoi.10808" },
  { name: "Phan Nguy·ªÖn Thi√™n Ph√∫c", role: "Th√†nh Vi√™n", holy: "GioanBaotixita", birth: "2007", school: "ƒê·∫°i H·ªçc ƒê√† L·∫°t", major: "CN k·ªπ thu·∫≠t m√¥i tr∆∞·ªùng", join: "2025", avatar: "phuc.jpg", fb: "https://www.facebook.com/Spinipop" },
  { name: "Nguy·ªÖn Ch√°nh Ho√†ng Qu√¢n", role: "H√†ng X√≥m", holy: "Phanxico Xavie", birth: "2006", school: "Cao ƒê·∫≥ng ƒê√† L·∫°t", major: "Ng√¥n Ng·ªØ Anh", join: "2025", avatar: "quan.jpg" },
  { name: "L√™ Ho√†ng Thi√™n Ph√∫c", role: "C·ª±u", holy: "ƒêaminh Savio", birth: "2004", school: "ƒê·∫°i h·ªçc Yersin", major: "T√¢m L√Ω H·ªçc", join: "2025", avatar: "mini.jpg", fb: "https://www.facebook.com/phucmini01082004" },
  { name: "L√™ Vƒ©nh Th√†nh", role: "C·ª±u", holy: "Toma", birth: "2002", school: "ƒê·∫°i H·ªçc ƒê√† L·∫°t", major: "Ng√¥n Ng·ªØ Anh", join: "2020", avatar: "thanh.jpg", fb: "https://web.facebook.com/LeVinhThanh11" },
  { name: "K Thuy·ªÅn", role: "C·ª±u", holy: "Giuse", birth: "2005", school: "ƒê·∫°i H·ªçc ƒê√† L·∫°t", major: "Khoa h·ªçc d·ªØ li·ªáu", join: "2024", avatar: "thuyen.jpg" },
  { name: "V≈© Tr·∫ßn Ho√†ng B·∫£o", role: "C·ª±u", holy: "ƒêaminh", birth: "2006", school: "ƒê·∫°i H·ªçc ƒê√† L·∫°t", major: "Ng√¥n ng·ªØ anh", join: "2024", avatar: "bao.jpg" },
  { name: "Ph·∫°m Tr·∫ßn Tu·∫•n Anh", role: "C·ª±u", holy: "Giuse", birth: "2005", school: "ƒê·∫°i H·ªçc ƒê√† L·∫°t", major: "Lu·∫≠t d√¢n s·ª±", join: "2023", avatar: "tuananh.jpg" },
  { name: "Rmah Long", role: "C·ª±u", holy: "Giuse", birth: "2000", school: "ƒê·∫°i H·ªçc ƒê√† L·∫°t", major: "Gi√°o d·ª•c ti·ªÉu h·ªçc", join: "2023", avatar: "long.jpg" },
  { name: "Tr·∫ßn Thi√™n", role: "C·ª±u", holy: "", birth: "2001", school: "ƒê·∫°i H·ªçc ƒê√† L·∫°t", major: "C√¥ng ngh·ªá th√¥ng tin", join: "2019", avatar: "thien.jpg" },
  { name: "Roda K Hi·ªáp", role: "C·ª±u", holy: "Giuse", birth: "2002", school: "ƒê·∫°i H·ªçc ƒê√† L·∫°t", major: "N√¥ng H·ªçc", join: "2020", avatar: "hiep.jpg" }
];

const PRE_DATA_ACTS = [
  { title: "N·ªòP ƒê∆†N GIA NH·∫¨P LXBC", sum: "ƒêƒÉng k√Ω ƒë·ªÉ tr·ªü th√†nh th√†nh vi√™n ch√≠nh th·ª©c.", tag: "H∆∞·ªõng d·∫´n", year: "", img: "nopdon.jpg", link: "https://docs.google.com/forms/d/1CZDA4neWpuzDb2Yt9v54WbPFIqpkLmxR-Hod9oaFlFQ/edit?hl=vi", hotVal: 1, cta: "N·ªôp ƒê∆°n" },
  { title: "TKB-LXBC", sum: "Xem th·ªùi kh√≥a bi·ªÉu sinh ho·∫°t chung c·ªßa nh√†.", tag: "D·ªãch v·ª•", year: "", img: "tkb.jpg", link: "https://lxbc.netlify.app/tkb", hotVal: 999, cta: "ƒê·∫æN TKB ·∫¢O" }
];

(async () => {
  try { 
    const res = await fetch('thanhvien.xlsx'); 
    if(res.ok) { const buf = await res.arrayBuffer(); parseMembers(buf); $('#drop').style.display = 'none'; } 
    else parseMembers(PRE_DATA); 
  } catch(e) { parseMembers(PRE_DATA); }

  try { 
    const resA = await fetch('hoatdong.xlsx'); 
    if(resA.ok) { const bufA = await resA.arrayBuffer(); parseActs(bufA); } 
    else parseActs(PRE_DATA_ACTS); 
  } catch(e) { parseActs(PRE_DATA_ACTS); }
})();

const slides = $$('.slide'), dots = $('#dots');
let cur = 0;
slides.forEach((_,i)=>{ const d=document.createElement('div'); d.className=`dot ${i===0?'active':''}`; d.onclick=()=>setSlide(i); dots.appendChild(d); });
function setSlide(i){ 
  slides.forEach(s=>s.classList.remove('active')); 
  $$('.dot').forEach(d=>d.classList.remove('active')); 
  slides[i].classList.add('active'); 
  $$('.dot')[i].classList.add('active'); 
  cur=i; 
}
setInterval(()=>setSlide((cur+1)%slides.length), 5000);
$('#year').innerText = new Date().getFullYear();
</script>
</body>
</html>
